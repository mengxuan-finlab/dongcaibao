<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>æ‡‚æ‰æŠ±ï¼æ ¸å¿ƒæŒ‡æ¨™é¸è‚¡å™¨</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- Supabase JS v2 -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <link rel="stylesheet" href="css/core_screener.css" />
</head>
<body>
  <div class="container">
    <h1>æ‡‚æ‰æŠ±æ ¸å¿ƒæŒ‡æ¨™é¸è‚¡å™¨</h1>
    <p class="subtitle">è³‡æ–™ä¾†è‡ª core_metricsï¼šå¸‚å€¼ã€ROAã€ROEã€FCF Yieldã€ç¾é‡‘è½‰æ›é€±æœŸã€‚</p>

    <div class="filters">
      <div class="filter-group">
        <label for="capFilter">å¸‚å€¼</label>
        <select id="capFilter">
          <option value="all">å…¨éƒ¨</option>
          <option value="mega">è¶…å¤§å‹ â‰¥ 300B</option>
          <option value="large">å¤§å‹ â‰¥ 100B</option>
          <option value="mid">ä¸­å‹ â‰¥ 10B</option>
          <option value="small">å°å‹ &lt; 10B</option>
        </select>
      </div>

      <div class="filter-group">
        <label for="roeFilter">ROE â‰¥</label>
        <select id="roeFilter">
          <option value="0">0%</option>
          <option value="10">10%</option>
          <option value="15">15%</option>
          <option value="20">20%</option>
          <option value="30">30%</option>
        </select>
      </div>

      <div class="filter-group">
        <label for="roicFilter">ROIC â‰¥</label>
        <select id="roicFilter">
          <option value="0">0%</option>
          <option value="0.10">10%</option>
          <option value="0.15">15%</option>
          <option value="0.20">20%</option>
        </select>
      </div>

      <div class="filter-group">
        <label for="fcfFilter">FCF Yield â‰¥</label>
        <select id="fcfFilter">
          <option value="0">0%</option>
          <option value="0.02">2%</option>
          <option value="0.04">4%</option>
          <option value="0.06">6%</option>
        </select>
      </div>

      
      <div class="filter-group">
        <label for="eyFilter">Earnings Yield â‰¥</label>
        <select id="eyFilter">
          <option value="0">0%</option>
          <option value="0.04">4%</option>
          <option value="0.06">6%</option>
          <option value="0.08">8%</option>
        </select>
      </div>

    
      <div class="filter-group">
        <label for="crFilter">æµå‹•æ¯”ç‡ â‰¥</label>
        <select id="crFilter">
          <option value="0">ä¸é™</option>
          <option value="1">1.0</option>
          <option value="1.5">1.5</option>
          <option value="2">2.0</option>
        </select>
      </div>

      <div class="filter-group">
        <label for="ndFilter">Net debt / EBITDA â‰¤</label>
        <select id="ndFilter">
          <option value="all">å…¨éƒ¨</option>
          <option value="4">4x</option>
          <option value="3">3x</option>
          <option value="2">2x</option>
          <option value="1">1x</option>
        </select>
      </div>


      <div class="filter-group">
        <label for="cccFilter">CCC</label>
        <select id="cccFilter">
          <option value="all">å…¨éƒ¨</option>
          <option value="neg">å°æ–¼ 0ï¼ˆå„ªå‹¢ï¼‰</option>
          <option value="pos">å¤§æ–¼ç­‰æ–¼ 0</option>
        </select>
      </div>


      <div class="filter-group">
        <label for="peFilter">PE â‰¤</label>
        <select id="peFilter">
          <option value="all">ä¸é™</option>
          <option value="40">40</option>
          <option value="30">30</option>
          <option value="20">20</option>
          <option value="15">15</option>
          <option value="10">10</option>
        </select>
      </div>

      <div class="filter-group">
        <label for="pegFilter">PEG â‰¤</label>
        <select id="pegFilter">
          <option value="all">ä¸é™</option>
          <option value="2">2.0</option>
          <option value="1.5">1.5</option>
          <option value="1">1.0</option>
          <option value="0.5">0.5</option>
        </select>
      </div>

      <div class="filter-group">
        <label for="psFilter">PS â‰¤</label>
        <select id="psFilter">
          <option value="all">ä¸é™</option>
          <option value="10">10</option>
          <option value="5">5</option>
          <option value="3">3</option>
          <option value="2">2</option>
        </select>
      </div>

      <div class="filter-group">
        <label for="pbFilter">PB â‰¤</label>
        <select id="pbFilter">
          <option value="all">ä¸é™</option>
          <option value="10">10</option>
          <option value="5">5</option>
          <option value="3">3</option>
          <option value="2">2</option>
        </select>
      </div>

      <div class="filter-group">
        <label for="pfcfFilter">P/FCF â‰¤</label>
        <select id="pfcfFilter">
          <option value="all">ä¸é™</option>
          <option value="40">40</option>
          <option value="30">30</option>
          <option value="20">20</option>
          <option value="15">15</option>
          <option value="10">10</option>
        </select>
      </div>

      <div class="filter-group">
        <label for="deFilter">Debt/Equity â‰¤</label>
        <select id="deFilter">
          <option value="all">ä¸é™</option>
          <option value="2">2.0</option>
          <option value="1.5">1.5</option>
          <option value="1">1.0</option>
          <option value="0.5">0.5</option>
        </select>
      </div>

      <div class="filter-group">
        <label for="daFilter">Debt/Asset â‰¤</label>
        <select id="daFilter">
          <option value="all">ä¸é™</option>
          <option value="0.8">0.8</option>
          <option value="0.6">0.6</option>
          <option value="0.4">0.4</option>
          <option value="0.2">0.2</option>
        </select>
      </div>

            <!-- â˜… è‚¡åˆ©ç›¸é—œ -->
      <div class="filter-group">
        <label for="dyFilter">Div Yield â‰¥</label>
        <select id="dyFilter">
          <option value="0">ä¸é™</option>
          <option value="0.02">2%</option>
          <option value="0.03">3%</option>
          <option value="0.04">4%</option>
          <option value="0.05">5%</option>
        </select>
      </div>

      <div class="filter-group">
        <label for="dpFilter">Payout â‰¤</label>
        <select id="dpFilter">
          <option value="all">ä¸é™</option>
          <option value="0.8">80%</option>
          <option value="0.6">60%</option>
          <option value="0.4">40%</option>
        </select>
      </div>

      <!-- â˜… ç²åˆ©çµæ§‹ -->
      <div class="filter-group">
        <label for="gmFilter">Gross% â‰¥</label>
        <select id="gmFilter">
          <option value="0">ä¸é™</option>
          <option value="0.3">30%</option>
          <option value="0.4">40%</option>
          <option value="0.5">50%</option>
        </select>
      </div>

      <div class="filter-group">
        <label for="omFilter">Opm% â‰¥</label>
        <select id="omFilter">
          <option value="0">ä¸é™</option>
          <option value="0.1">10%</option>
          <option value="0.15">15%</option>
          <option value="0.2">20%</option>
        </select>
      </div>

      <div class="filter-group">
        <label for="evFilter">EV/EBITDA â‰¤</label>
        <select id="evFilter">
          <option value="all">ä¸é™</option>
          <option value="20">20</option>
          <option value="15">15</option>
          <option value="10">10</option>
        </select>
      </div>

      <!-- â˜… æˆé•·ç‡ -->
      <div class="filter-group">
        <label for="rgFilter">Rev YoY â‰¥</label>
        <select id="rgFilter">
          <option value="0">ä¸é™</option>
          <option value="0.05">5%</option>
          <option value="0.1">10%</option>
          <option value="0.15">15%</option>
        </select>
      </div>

      <div class="filter-group">
        <label for="egFilter">EPS YoY â‰¥</label>
        <select id="egFilter">
          <option value="0">ä¸é™</option>
          <option value="0.05">5%</option>
          <option value="0.1">10%</option>
          <option value="0.2">20%</option>
        </select>
      </div>

      <div class="filter-group">
        <label for="fgFilter">FCF YoY â‰¥</label>
        <select id="fgFilter">
          <option value="0">ä¸é™</option>
          <option value="0.05">5%</option>
          <option value="0.1">10%</option>
          <option value="0.2">20%</option>
        </select>
      </div>

      <div class="filter-group">
        <label for="dgFilter">Div YoY â‰¥</label>
        <select id="dgFilter">
          <option value="0">ä¸é™</option>
          <option value="0.03">3%</option>
          <option value="0.05">5%</option>
          <option value="0.1">10%</option>
        </select>
      </div>


      <div class="filter-group">
        <label for="sectorFilter">Sector</label>
        <select id="sectorFilter">
          <option value="all">å…¨éƒ¨</option>
          <option value="Basic Materials">Basic Materials</option>
          <option value="Communication Services">Communication Services</option>
          <option value="Consumer Cyclical">Consumer Cyclical</option>
          <option value="Consumer Defensive">Consumer Defensive</option>
          <option value="Energy">Energy</option>
          <option value="Financial Services">Financial Services</option>
          <option value="Healthcare">Healthcare</option>
          <option value="Industrials">Industrials</option>
          <option value="Real Estate">Real Estate</option>
          <option value="Technology">Technology</option>
          <option value="Utilities">Utilities</option>
        </select>
      </div>

      <div class="filter-group">
        <label for="betaFilter">Beta â‰¤</label>
        <select id="betaFilter">
          <option value="all">ä¸é™</option>
          <option value="1.5">1.5</option>
          <option value="1.2">1.2</option>
          <option value="1.0">1.0</option>
          <option value="0.8">0.8</option>
        </select>
      </div>

          <!-- ä¸€éµç­–ç•¥æŒ‰éˆ•åˆ— -->
      <div class="preset-bar">
          <button class="preset-btn" data-preset="buffett">Buffett æŒ‡æ¨™</button>
          <button class="preset-btn" data-preset="dividend">é«˜è‚¡æ¯ç­–ç•¥</button>
          <button class="preset-btn" data-preset="growth">é«˜æˆé•·ç­–ç•¥</button>
          <button class="preset-btn" data-preset="value">åƒ¹å€¼è‚¡ç­–ç•¥</button>
      </div>


    </div>

    <div class="summary" id="summaryText">è¼‰å…¥ä¸­...</div>

    <table>
      <thead>
        <tr>
          <th data-sort="symbol">Symbol</th>
          <th data-sort="market_cap">å¸‚å€¼</th>
          <th data-sort="sector">Sector</th>
          <th data-sort="beta">Beta</th>
          <th data-sort="roa">ROA</th>
          <th data-sort="roe">ROE</th>
          <th data-sort="roic">ROIC</th>
          <th data-sort="fcf_yield">FCF Yield</th>
          <th data-sort="earnings_yield">Earnings Yield</th>
          <th data-sort="current_ratio">æµå‹•æ¯”ç‡</th>
          <th data-sort="net_debt_to_ebitda">Net debt/EBITDA</th>
          <th data-sort="ccc">CCC</th>
          <th data-sort="pe">PE</th>
          <th data-sort="peg">PEG</th>
          <th data-sort="ps">PS</th>
          <th data-sort="pb">PB</th>
          <th data-sort="p_fcf">P/FCF</th>
          <th data-sort="debt_to_equity">Debt/Equity</th>
          <th data-sort="debt_to_asset">Debt/Asset</th>
          <th data-sort="dividendyield">Div Yield</th>          
          <th data-sort="dividendpershare">Div / Share</th>    
          <th data-sort="dividendpayoutratio">Payout%</th>     
          <th data-sort="grossmargin">Gross%</th>      
          <th data-sort="operatingmargin">Opm%</th>         
          <th data-sort="evtoebitda">EV/EBITDA</th>         
          <th data-sort="revenue_growth">Rev YoY%</th>        
          <th data-sort="eps_growth">EPS YoY%</th>            
          <th data-sort="fcf_growth">FCF YoY%</th>            
          <th data-sort="dividend_growth">Div YoY%</th>        
        </tr>
      </thead>
      <tbody id="tableBody"></tbody>
    </table>
  </div>

  <script>
  // === Supabase è¨­å®š ===
  const SUPABASE_URL = "https://ojeirmqxborwxhuwuems.supabase.co";
  const SUPABASE_ANON_KEY = "sb_publishable_wur9F2qRW0NFyZpijPub2A__IsGlpgZ";

  const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  let allRows = [];
  let sortState = { key: "market_cap", dir: "desc" };

  function formatCap(x) {
    if (x == null) return "-";
    if (x >= 1e12) return (x / 1e12).toFixed(2) + " T";
    if (x >= 1e9)  return (x / 1e9 ).toFixed(2) + " B";
    if (x >= 1e6)  return (x / 1e6 ).toFixed(2) + " M";
    return x.toLocaleString();
  }
  function pct(x) {
    if (x == null) return "-";
    return (x * 100).toFixed(2) + "%";
  }

  // ğŸ”¹ å°å·¥å…·ï¼šè¨­å®šæŸå€‹ select çš„å€¼
  function setSelect(id, value) {
    const el = document.getElementById(id);
    if (el && value !== undefined) {
      el.value = value;
    }
  }

  // ğŸ”¹ ä¸€éµç­–ç•¥ï¼šä¾åç¨±èª¿æ•´æ‰€æœ‰ç¯©é¸å™¨
  function applyPreset(name) {
    // å…ˆé‡ç½®æˆã€Œä¸é™ / å…¨éƒ¨ã€
    setSelect("capFilter",   "all");
    setSelect("roeFilter",   "0");
    setSelect("roicFilter",  "0");
    setSelect("fcfFilter",   "0");
    setSelect("eyFilter",    "0");
    setSelect("crFilter",    "0");
    setSelect("ndFilter",    "all");
    setSelect("cccFilter",   "all");
    setSelect("peFilter",    "all");
    setSelect("pegFilter",   "all");
    setSelect("psFilter",    "all");
    setSelect("pbFilter",    "all");
    setSelect("pfcfFilter",  "all");
    setSelect("deFilter",    "all");
    setSelect("daFilter",    "all");
    setSelect("dyFilter",    "0");
    setSelect("dpFilter",    "all");
    setSelect("gmFilter",    "0");
    setSelect("omFilter",    "0");
    setSelect("evFilter",    "all");
    setSelect("rgFilter",    "0");
    setSelect("egFilter",    "0");
    setSelect("fgFilter",    "0");
    setSelect("dgFilter",    "0");
    setSelect("sectorFilter","all");
    setSelect("betaFilter",  "all");

    if (name === "buffett") {
      // Buffett æŒ‡æ¨™
      setSelect("roeFilter",  "15");    // ROE â‰¥ 15%
      setSelect("roicFilter", "0.10");  // ROIC â‰¥ 10%
      setSelect("fcfFilter",  "0.04");  // FCF Yield â‰¥ 4%
      setSelect("eyFilter",   "0.06");  // Earnings Yield â‰¥ 6%
      setSelect("gmFilter",   "0.4");   // Gross â‰¥ 40%
      setSelect("omFilter",   "0.1");   // Opm â‰¥ 10%
      setSelect("dpFilter",   "0.6");   // Payout â‰¤ 60%
      setSelect("deFilter",   "0.5");   // D/E â‰¤ 0.5
      setSelect("betaFilter", "1.0");   // Beta â‰¤ 1
    }

    if (name === "dividend") {
      // é«˜è‚¡æ¯ç­–ç•¥
      setSelect("dyFilter",   "0.04");  // Div Yield â‰¥ 4%
      setSelect("dpFilter",   "0.8");   // Payout â‰¤ 80%
      setSelect("deFilter",   "1");     // D/E â‰¤ 1
      setSelect("betaFilter", "1.0");   // Beta â‰¤ 1
      setSelect("rgFilter",   "0.05");  // Rev YoY â‰¥ 5%
    }

    if (name === "growth") {
      // é«˜æˆé•·ç­–ç•¥
      setSelect("rgFilter",   "0.15");  // Rev YoY â‰¥ 15%
      setSelect("egFilter",   "0.2");   // EPS YoY â‰¥ 20%
      setSelect("gmFilter",   "0.5");   // Gross â‰¥ 50%
      setSelect("omFilter",   "0.1");   // Opm â‰¥ 10%
      setSelect("psFilter",   "10");    // PS â‰¤ 10
    }

    if (name === "value") {
      // åƒ¹å€¼è‚¡ç­–ç•¥
      setSelect("peFilter",   "15");    // PE â‰¤ 15
      setSelect("pbFilter",   "2");     // PB â‰¤ 2
      setSelect("pfcfFilter", "15");    // P/FCF â‰¤ 15
      setSelect("eyFilter",   "0.08");  // Earnings Yield â‰¥ 8%
      setSelect("fcfFilter",  "0.04");  // FCF Yield â‰¥ 4%
    }

    applyFiltersAndRender();
  }

  async function loadData() {
    const { data, error } = await supabase
      .from("core_metrics")
      .select(`
        symbol,
        market_cap,
        roa,
        roe,
        roic,
        fcf_yield,
        earnings_yield,
        current_ratio,
        net_debt_to_ebitda,
        ccc,
        pe,
        peg,
        ps,
        pb,
        p_fcf,
        debt_to_equity,
        debt_to_asset,
        dividendpayoutratio,   
        dividendyield,          
        dividendpershare,       
        grossmargin,            
        operatingmargin,        
        evtoebitda,            
        revenue_growth,       
        eps_growth,             
        fcf_growth,             
        dividend_growth,
        beta,
        sector         
      `);

    if (error) {
      console.error(error);
      document.getElementById("summaryText").textContent = "è¼‰å…¥å¤±æ•—";
      return;
    }

    allRows = data;
    applyFiltersAndRender();
  }

  function applyFiltersAndRender() {
    const capMode = document.getElementById("capFilter").value;
    const roeMin = Number(document.getElementById("roeFilter").value) / 100;
    const fcfMin = Number(document.getElementById("fcfFilter").value);
    const roicMin = Number(document.getElementById("roicFilter").value);
    const eyMin = Number(document.getElementById("eyFilter").value);   
    const crMin = Number(document.getElementById("crFilter").value);  
    const ndMode = document.getElementById("ndFilter").value;   
    const cccMode = document.getElementById("cccFilter").value;
    const peMode   = document.getElementById("peFilter").value;
    const pegMode  = document.getElementById("pegFilter").value;
    const psMode   = document.getElementById("psFilter").value;
    const pbMode   = document.getElementById("pbFilter").value;
    const pfcfMode = document.getElementById("pfcfFilter").value;
    const deMode   = document.getElementById("deFilter").value;
    const daMode   = document.getElementById("daFilter").value;
    const dyMin  = Number(document.getElementById("dyFilter").value);
    const dpMode = document.getElementById("dpFilter").value;

    const gmMin = Number(document.getElementById("gmFilter").value);
    const omMin = Number(document.getElementById("omFilter").value);
    const evMode = document.getElementById("evFilter").value;

    const rgMin = Number(document.getElementById("rgFilter").value);
    const egMin = Number(document.getElementById("egFilter").value);
    const fgMin = Number(document.getElementById("fgFilter").value);
    const dgMin = Number(document.getElementById("dgFilter").value);
    const sectorMode = document.getElementById("sectorFilter").value;
    const betaMode   = document.getElementById("betaFilter").value;

    let rows = allRows.filter(r => {
      // å¸‚å€¼
      if (capMode !== "all") {
        const cap = r.market_cap || 0;
        if (capMode === "mega" && !(cap >= 3e11)) return false;
        if (capMode === "large" && !(cap >= 1e11)) return false;
        if (capMode === "mid"   && !(cap >= 1e10 && cap < 1e11)) return false;
        if (capMode === "small" && !(cap <  1e10)) return false;
      }

      // ç²åˆ© & ç¾é‡‘æµ
      if (r.roe == null || r.roe < roeMin) return false;
      if (r.fcf_yield == null || r.fcf_yield < fcfMin) return false;
      if (r.roic == null || r.roic < roicMin) return false;
      if (r.earnings_yield == null || r.earnings_yield < eyMin) return false;

      // æµå‹•æ¯”ç‡
      if (crMin > 0 && (r.current_ratio == null || r.current_ratio < crMin)) return false;

      // Net debt / EBITDA
      if (ndMode !== "all") {
        const ndMax = Number(ndMode);
        if (r.net_debt_to_ebitda == null || r.net_debt_to_ebitda > ndMax) return false;
      }

      // CCC
      if (cccMode === "neg" && !(r.ccc < 0)) return false;
      if (cccMode === "pos" && !(r.ccc >= 0)) return false;

      // ä¼°å€¼å€ç‡
      if (peMode !== "all") {
        const maxPE = Number(peMode);
        if (r.pe == null || r.pe > maxPE) return false;
      }
      if (pegMode !== "all") {
        const maxPEG = Number(pegMode);
        if (r.peg == null || r.peg > maxPEG) return false;
      }
      if (psMode !== "all") {
        const maxPS = Number(psMode);
        if (r.ps == null || r.ps > maxPS) return false;
      }
      if (pbMode !== "all") {
        const maxPB = Number(pbMode);
        if (r.pb == null || r.pb > maxPB) return false;
      }
      if (pfcfMode !== "all") {
        const maxPFCF = Number(pfcfMode);
        if (r.p_fcf == null || r.p_fcf > maxPFCF) return false;
      }

      // æ§“æ¡¿
      if (deMode !== "all") {
        const maxDE = Number(deMode);
        if (r.debt_to_equity == null || r.debt_to_equity > maxDE) return false;
      }
      if (daMode !== "all") {
        const maxDA = Number(daMode);
        if (r.debt_to_asset == null || r.debt_to_asset > maxDA) return false;
      }

      // è‚¡åˆ©æ¢ä»¶
      if (dyMin > 0 && (r.dividendyield == null || r.dividendyield < dyMin)) return false;
      if (dpMode !== "all") {
        const maxDP = Number(dpMode);
        if (r.dividendpayoutratio == null || r.dividendpayoutratio > maxDP) return false;
      }

      // ç²åˆ©çµæ§‹
      if (gmMin > 0 && (r.grossmargin == null || r.grossmargin < gmMin)) return false;
      if (omMin > 0 && (r.operatingmargin == null || r.operatingmargin < omMin)) return false;

      if (evMode !== "all") {
        const maxEV = Number(evMode);
        if (r.evtoebitda == null || r.evtoebitda > maxEV) return false;
      }

      // æˆé•·ç‡
      if (rgMin > 0 && (r.revenue_growth == null || r.revenue_growth < rgMin)) return false;
      if (egMin > 0 && (r.eps_growth == null || r.eps_growth < egMin)) return false;
      if (fgMin > 0 && (r.fcf_growth == null || r.fcf_growth < fgMin)) return false;
      if (dgMin > 0 && (r.dividend_growth == null || r.dividend_growth < dgMin)) return false;

      // Sector
      if (sectorMode !== "all") {
        if (!r.sector || r.sector !== sectorMode) return false;
      }

      // Beta
      if (betaMode !== "all") {
        const maxBeta = Number(betaMode);
        if (r.beta == null || r.beta > maxBeta) return false;
      }

      return true;
    });

    // æ’åºï¼ˆæ•¸å­— / å­—ä¸²éƒ½æ”¯æ´ï¼‰
    rows.sort((a, b) => {
      const k = sortState.key;
      const va = a[k];
      const vb = b[k];

      if (va == null) return 1;
      if (vb == null) return -1;

      // å­—ä¸²ï¼šç”¨å­—æ¯æ’åº
      if (typeof va === "string" || typeof vb === "string") {
        return sortState.dir === "asc"
          ? String(va).localeCompare(String(vb))
          : String(vb).localeCompare(String(va));
      }
      // æ•¸å­—
      return sortState.dir === "asc" ? va - vb : vb - va;
    });

    renderTable(rows);
  }

  function renderTable(rows) {
    const tbody = document.getElementById("tableBody");
    const summary = document.getElementById("summaryText");
    tbody.innerHTML = "";
    summary.textContent = `ç¬¦åˆæ¢ä»¶çš„è‚¡ç¥¨ï¼š${rows.length} æª”`;

    rows.forEach(r => {
      const cccClass = r.ccc != null && r.ccc < 0 ? "pill-pos" : "";
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td><span class="badge">${r.symbol}</span></td>
        <td>${formatCap(r.market_cap)}</td>
        <td>${r.sector || "-"}</td>
        <td>${r.beta != null ? r.beta.toFixed(2) : "-"}</td>
        <td>${pct(r.roa)}</td>
        <td>${pct(r.roe)}</td>
        <td>${pct(r.roic)}</td>
        <td>${pct(r.fcf_yield)}</td>
        <td>${pct(r.earnings_yield)}</td>
        <td>${r.current_ratio != null ? r.current_ratio.toFixed(2) : "-"}</td>
        <td>${r.net_debt_to_ebitda != null ? r.net_debt_to_ebitda.toFixed(2) : "-"}</td>
        <td class="${cccClass}">${r.ccc != null ? r.ccc.toFixed(2) : "-"}</td>
        <td>${r.pe != null ? r.pe.toFixed(2) : "-"}</td>
        <td>${r.peg != null ? r.peg.toFixed(2) : "-"}</td>
        <td>${r.ps != null ? r.ps.toFixed(2) : "-"}</td>
        <td>${r.pb != null ? r.pb.toFixed(2) : "-"}</td>
        <td>${r.p_fcf != null ? r.p_fcf.toFixed(2) : "-"}</td>
        <td>${r.debt_to_equity != null ? r.debt_to_equity.toFixed(2) : "-"}</td>
        <td>${r.debt_to_asset != null ? r.debt_to_asset.toFixed(2) : "-"}</td>
        <td>${pct(r.dividendyield)}</td>
        <td>${r.dividendpershare != null ? r.dividendpershare.toFixed(2) : "-"}</td>
        <td>${pct(r.dividendpayoutratio)}</td>
        <td>${pct(r.grossmargin)}</td>
        <td>${pct(r.operatingmargin)}</td>
        <td>${r.evtoebitda != null ? r.evtoebitda.toFixed(2) : "-"}</td>
        <td>${pct(r.revenue_growth)}</td>
        <td>${pct(r.eps_growth)}</td>
        <td>${pct(r.fcf_growth)}</td>
        <td>${pct(r.dividend_growth)}</td>
      `;
      tbody.appendChild(tr);
    });
  }

  // ç¯©é¸å™¨ change äº‹ä»¶
  document.getElementById("capFilter").addEventListener("change", applyFiltersAndRender); 
  document.getElementById("roeFilter").addEventListener("change", applyFiltersAndRender);
  document.getElementById("roicFilter").addEventListener("change", applyFiltersAndRender);
  document.getElementById("fcfFilter").addEventListener("change", applyFiltersAndRender);
  document.getElementById("eyFilter").addEventListener("change", applyFiltersAndRender);   
  document.getElementById("crFilter").addEventListener("change", applyFiltersAndRender);   
  document.getElementById("ndFilter").addEventListener("change", applyFiltersAndRender); 
  document.getElementById("cccFilter").addEventListener("change", applyFiltersAndRender);
  document.getElementById("peFilter").addEventListener("change", applyFiltersAndRender);
  document.getElementById("pegFilter").addEventListener("change", applyFiltersAndRender);
  document.getElementById("psFilter").addEventListener("change", applyFiltersAndRender);
  document.getElementById("pbFilter").addEventListener("change", applyFiltersAndRender);
  document.getElementById("pfcfFilter").addEventListener("change", applyFiltersAndRender);
  document.getElementById("deFilter").addEventListener("change", applyFiltersAndRender);
  document.getElementById("daFilter").addEventListener("change", applyFiltersAndRender);
  document.getElementById("dyFilter").addEventListener("change", applyFiltersAndRender);
  document.getElementById("dpFilter").addEventListener("change", applyFiltersAndRender);
  document.getElementById("gmFilter").addEventListener("change", applyFiltersAndRender);
  document.getElementById("omFilter").addEventListener("change", applyFiltersAndRender);
  document.getElementById("evFilter").addEventListener("change", applyFiltersAndRender);
  document.getElementById("rgFilter").addEventListener("change", applyFiltersAndRender);
  document.getElementById("egFilter").addEventListener("change", applyFiltersAndRender);
  document.getElementById("fgFilter").addEventListener("change", applyFiltersAndRender);
  document.getElementById("dgFilter").addEventListener("change", applyFiltersAndRender);
  document.getElementById("sectorFilter").addEventListener("change", applyFiltersAndRender);
  document.getElementById("betaFilter").addEventListener("change", applyFiltersAndRender);

  // ğŸ”¹ ä¸€éµç­–ç•¥æŒ‰éˆ•äº‹ä»¶ï¼ˆè¨˜å¾—ä¸Šé¢ HTML è¦æœ‰ .preset-btnï¼‰
  document.querySelectorAll(".preset-btn").forEach(btn => {
    btn.addEventListener("click", () => {
      const name = btn.dataset.preset;  // buffett / dividend / growth / value
      applyPreset(name);
    });
  });

  // æ’åºäº‹ä»¶
  document.querySelectorAll("th[data-sort]").forEach(th => {
    th.addEventListener("click", () => {
      const key = th.dataset.sort;
      if (sortState.key === key) {
        sortState.dir = sortState.dir === "asc" ? "desc" : "asc";
      } else {
        sortState.key = key;
        sortState.dir = "desc";
      }
      applyFiltersAndRender();
    });
  });

  loadData();
</script>
</body>
</html>
